#! /usr/bin/env gforth
\                                           -*- forth -*-

vocabulary dmgforth
get-current
also dmgforth definitions
constant previous-wid

also dmgforth

require ./src/rom.fs
require ./src/asm.fs

also gb-assembler
' rom, IS emit
' rom-offset IS offset
' rom! IS emit-to
previous

rom erase

include ./src/cartridge.fs

( command line arguments processing )

: output-file s" output.gb" ;
: usage
  ." Usage: dmgforth game.fs" cr
  1 (bye) ;

argc @ 2 <> [if]
  ' usage stderr outfile-execute
[then]

next-arg included


depth 0<> [if]
  ." The stac2k is not empty!" cr
[endif]



fix-header-complement
output-file dump-rom
." Generated file " output-file type cr
bye
